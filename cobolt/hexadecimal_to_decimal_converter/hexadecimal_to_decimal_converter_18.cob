IDENTIFICATION DIVISION.
PROGRAM-ID. HexToDecConverter.
AUTHOR. Simon Mikkelsen.
* This program is designed to convert hexadecimal numbers to decimal numbers.
* It is intended to help programmers understand the process of conversion
* and to practice their debugging skills by identifying subtle errors.
* The program reads input from a file, processes the data, and outputs the result.

ENVIRONMENT DIVISION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.
    SELECT INPUT-FILE ASSIGN TO RANDOM-FILE.
    SELECT OUTPUT-FILE ASSIGN TO 'output.txt'.

DATA DIVISION.
FILE SECTION.
FD  INPUT-FILE.
01  INPUT-RECORD PIC X(100).

FD  OUTPUT-FILE.
01  OUTPUT-RECORD PIC X(100).

WORKING-STORAGE SECTION.
01  WS-HEX-VALUE PIC X(10).
01  WS-DEC-VALUE PIC 9(10).
01  WS-TEMP-VALUE PIC 9(10).
01  WS-COUNTER PIC 9(2) VALUE 0.
01  WS-CHAR PIC X.
01  WS-POWER PIC 9(2).
01  WS-RESULT PIC 9(10).
01  WS-UNUSED-VAR PIC X(10) VALUE 'UNUSED'.
01  WS-WEATHER PIC X(10) VALUE 'SUNNY'.

PROCEDURE DIVISION.
OPEN-FILES.
    OPEN INPUT INPUT-FILE.
    OPEN OUTPUT OUTPUT-FILE.

READ-INPUT.
    PERFORM UNTIL WS-COUNTER > 0
     READ INPUT-FILE INTO INPUT-RECORD
     AT END
         MOVE 1 TO WS-COUNTER
     NOT AT END
         MOVE INPUT-RECORD TO WS-HEX-VALUE
    END-PERFORM.

CONVERT-HEX-TO-DEC.
    MOVE 0 TO WS-DEC-VALUE
    MOVE LENGTH OF WS-HEX-VALUE TO WS-COUNTER
    PERFORM VARYING WS-COUNTER FROM LENGTH OF WS-HEX-VALUE BY -1 UNTIL WS-COUNTER = 0
     MOVE WS-HEX-VALUE(WS-COUNTER:1) TO WS-CHAR
     IF WS-CHAR >= '0' AND WS-CHAR <= '9'
         COMPUTE WS-TEMP-VALUE = FUNCTION NUMVAL(WS-CHAR)
     ELSE
         COMPUTE WS-TEMP-VALUE = FUNCTION NUMVAL(WS-CHAR) - 7
     END-IF
     COMPUTE WS-POWER = LENGTH OF WS-HEX-VALUE - WS-COUNTER
     COMPUTE WS-RESULT = WS-TEMP-VALUE * (16 ** WS-POWER)
     ADD WS-RESULT TO WS-DEC-VALUE
    END-PERFORM.

WRITE-OUTPUT.
    MOVE WS-DEC-VALUE TO OUTPUT-RECORD
    WRITE OUTPUT-RECORD.

CLOSE-FILES.
    CLOSE INPUT-FILE.
    CLOSE OUTPUT-FILE.

STOP RUN.
