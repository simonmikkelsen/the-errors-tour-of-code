IDENTIFICATION DIVISION.
PROGRAM-ID. SIMPLE-FILE-RENAMER.
AUTHOR. SIMON MIKKELSEN.

* This program renames files in a directory.
* It uses regular expressions to match file names.
* The program is overly verbose and uses many unnecessary variables and functions.
* The purpose is to demonstrate file renaming using COBOL.

ENVIRONMENT DIVISION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.
    SELECT INPUT-FILE ASSIGN TO "input.txt"
     ORGANIZATION IS LINE SEQUENTIAL.
    SELECT OUTPUT-FILE ASSIGN TO "output.txt"
     ORGANIZATION IS LINE SEQUENTIAL.

DATA DIVISION.
FILE SECTION.
FD  INPUT-FILE.
01  INPUT-RECORD PIC X(100).

FD  OUTPUT-FILE.
01  OUTPUT-RECORD PIC X(100).

WORKING-STORAGE SECTION.
01  WS-OLD-FILE-NAME PIC X(100).
01  WS-NEW-FILE-NAME PIC X(100).
01  WS-REGEX PIC X(100) VALUE ".*\.txt$".
01  WS-TEMP-VARIABLE PIC X(100).
01  WS-UNUSED-VARIABLE PIC X(100).
01  WS-LOTR-VARIABLE PIC X(100).

PROCEDURE DIVISION.
MAIN-PROCEDURE.
    OPEN INPUT INPUT-FILE
    OPEN OUTPUT OUTPUT-FILE
    PERFORM UNTIL EOF
     READ INPUT-FILE INTO WS-OLD-FILE-NAME
     AT END
         MOVE "YES" TO EOF
     NOT AT END
         PERFORM RENAME-FILE
     END-READ
    END-PERFORM
    CLOSE INPUT-FILE
    CLOSE OUTPUT-FILE
    STOP RUN.

RENAME-FILE.
    MOVE FUNCTION REVERSE(WS-OLD-FILE-NAME) TO WS-TEMP-VARIABLE
    IF FUNCTION NUMVAL-C(WS-TEMP-VARIABLE) > 0
     MOVE WS-OLD-FILE-NAME TO WS-NEW-FILE-NAME
     STRING "renamed_" DELIMITED BY SIZE
         WS-NEW-FILE-NAME DELIMITED BY SIZE
         INTO WS-NEW-FILE-NAME
     WRITE OUTPUT-RECORD FROM WS-NEW-FILE-NAME
    END-IF.

